<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<!-- <link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html"> -->

<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="xl-schedule">
  <template>
  <style >
    :host{
      text-align: center;
      display: block;
    }
    h1 {
        text-align: center;
        font-weight: 400;
        font-size: 34px;
      }

      @media( min-width: 980px) {
        h1 {
          font-size: 56px;
        }
      }

      paper-tabs {
        background-color: #00BCD4;
        color: white;
        flex-grow: 1;
        margin: auto;
      }

      .container {
        width: 100%;
        /*max-width: 980px;*/
        margin: auto;
        display: flex;
      }
    .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        margin: 24px;
        background-color: #fff;
        color: #757575;
        padding-bottom:5px;
    }

    div.card>div{
      height:270px;
      z-index:99;
    }

    div.page-header{
      padding-bottom: 10px;
    }

    paper-card.event>div{
      text-align: center;
      order: 1;
      flex-grow: 1;
      transition: transform 1s;
    }

    paper-header-panel{
      z-index: 40;
    }

    .newfilter{
      position: absolute;
      width: 100%;
      margin: 0;
      z-index: -1;
      display: block;
      transform: translateY(0%);
      transition: transform 0.5s,opacity 0.2s;
      display: flex;
      opacity: 1;
    }

    .toggletrial{
      transform: translateY(-100%);
    }

    .filter-buttons{
      margin: auto;
      margin-bottom: 0;
      margin-right: 0;
      float: right;
      flex-grow: 1;
    }

    paper-radio-button{
      display: flex;
      text-align: left;
    }

    .department-filter{
      flex-grow: 5;
    }
    .type-filter{
      flex-grow: 5;
    }
    .revert{
      color: #ff3838;
    }
    .apply{
      color: #4f8a10;
    }

    @media (max-width: 700px){
      .card{
        margin:10px;
      }
      .newfilter{
        display: block;
        margin: 0;
      }
      paper-item paper-radio-button{
        display: block;
        margin: 0;
        padding-top: 0 !important;
        font-size: 15px !important;
      }
      h4{
        margin: 0;
      }
      .department-filter{
        padding: 0;
      }
      .type-filter{
        display: flex ;
        font-size: 15px;
        padding: 0;
      }
      .revert{
        font-size: 15px;
      }
      .apply{
        font-size: 15px;
      }
    }

    @media (max-width: 800px){
      div.card>div{
        height: 200px;
      }
      .toggletrial{
        opacity: 0;
      }
    }
  </style>
  <style is="custom-style" >
    paper-card.event{
      @apply(--layout-horizontal);
      padding-top: 5px;
      padding-bottom: 5px;
      /*border-top: 1px solid #b3b3b3;*/
      border-bottom: 1px solid #b3b3b3;
    }

    paper-item{
      --paper-item-selected-weight: normal;
    }
  </style>

    <div class="card" id='card'>      
      <div>
        <paper-header-panel mode="standard">
          <div class="paper-header" style="background-color:white;">
            <h1> Excel Schedule </h1>
            <paper-button active="{{stateChange}}" toggles on-click="toggleFilter" style="float:right;" noink>Filter<iron-icon icon="icons:filter-list"></iron-icon></paper-button>
            <div class="container" style="display:flex;">
              <paper-tabs selected="{{selectedDay}}" id="dayFilter">
                <paper-tab>All Days</paper-tab>
                <paper-tab>Day 1</paper-tab>
                <paper-tab>Day 2</paper-tab>
                <paper-tab>Day 3</paper-tab>
                <paper-tab>Day 4</paper-tab>
              </paper-tabs>
            </div>
            <div class="card newfilter toggletrial" id="filterList">
              <paper-listbox class="department-filter">
                <paper-item>
                  <label id="departments"><h4>Departments:</h4></label>
                </paper-item>
                <paper-item>
                  <paper-radio-group aria-labelledby="departments" attr-for-selected="value" selected="{{selectedFilter}}" id="departmentFilter" >
                    <paper-radio-button value="all">All Departments</paper-radio-button>
                    <paper-radio-button value="cs">Computer Science</paper-radio-button>
                    <paper-radio-button value="ec">Electronics and Communication</paper-radio-button>
                  </paper-radio-group>
                </paper-item>
              </paper-listbox>
              <paper-listbox class="type-filter">
                <paper-item><h4>Event Type:</h4></paper-item>
                <paper-item><paper-checkbox value="online" id="onlineBox" checked>Online Events</paper-checkbox></paper-item>
                <paper-item><paper-checkbox value="offline" id="offlineBox" checked>Offline Events</paper-checkbox></paper-item>
              </paper-listbox>
              <paper-button class="filter-buttons revert" noink id="resetButton">Revert</paper-button>
              <!-- <paper-button class="filter-buttons apply" noink on-click="applyFilter">Apply Changes</paper-button> -->
            </div>
          </div>
        </paper-header-panel>
      </div>
      <template id="scheduleList" is="dom-repeat" items="{{schedule}}" filter="computeFilter">
          <paper-card class="event" >              
              <div>
                <h2>{{item.name}}</h2>
                <div><h4>Venue</h4></div>
              </div>
              <div><h6>{{item.date}}</h6></div>              
          </paper-card>
      </template>
    </div>
  </template>


  <script>;

    Polymer({
      is: 'xl-schedule',

      listeners : {
        'dayFilter.click' : 'refreshFilter',
        'resetButton.tap' : 'resetFilter',
        'departmentFilter.click' : 'refreshFilter',
        'onlineBox.tap' : 'refreshFilter',
        'offlineBox.tap' : 'refreshFilter'
      },

      ready: function() {

              var _thisPage = this;

              fetch('resources/schedule.json').
              then(function (response) {
                  return response.json();
              }).
              then(function (response) {
                _thisPage.schedule = response;
              })
              .catch(function(err) {
                console.log("err",err);
              });
              this.selectedFilter = "all";
              this.selectedDay = "0";
     },

     computeFilter: function(item){
              var _self = this;
              var _department = _self.selectedFilter;
              var _scheduleItem = item;
              var _day;
              if(this.selectedDay == "0")
                _day = item.day;
              else
                _day = this.selectedDay;

              //Check if online and offline checkboxes are ticked
              var onlineState = (_self.$.onlineBox.checked) ? "online" : "not online";
              var offlineState = (_self.$.offlineBox.checked) ? "offline" : "not offline";
              //if event type (online or offline) does not match either of the checked boxes, return false

              if (!(_scheduleItem.type === onlineState || _scheduleItem.type === offlineState)) {
                return false;
              }

              //if no or all department(s) specified, return true
              if(!_department || _department === 'all'){
                return _day == item.day;
              }

              // check if department specified is same as data
              return _scheduleItem.department === _department && _day == item.day;

     },

     refreshFilter : function () {
        this.$.scheduleList.render();
     },

     toggleFilter : function(){
        if(this.stateChange){
          this.$.filterList.classList.remove('toggletrial');
        }
        else{
          this.$.filterList.classList.add('toggletrial');
        }
     },
     closeDrawer : function(){
        this.stateChange = false;
        this.toggleFilter();
     },

     resetFilter : function(){
        this.selectedFilter = "all";
        this.$.onlineBox.checked = true;
        this.$.offlineBox.checked = true;
        this.refreshFilter();
        this.closeDrawer();
     }
    });
  </script>

</dom-module>