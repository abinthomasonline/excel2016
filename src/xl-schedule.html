<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="xl-schedule">
  <template>

    <h1> Excel Schedule </h1>
    <div>
      Filter :  
      <select id="DeptSelector" autofocus value="{{dept::input}}">
        <option value="all" selected>All Departments</option>
        <option value="cs">Computer Science</option>
        <option value="ec">Electronics and Communication</option>
      </select>
      &nbspEvents :
        <input type="checkbox" value="online"  checked id="onlineBox" on-change="tweakFilter"> Online Events
        <input type="checkbox" value="offline" checked id="offlineBox" on-change="tweakFilter">Offline Events<br>
        </div>
    <template is="dom-repeat" items="{{schedule}}" filter="{{computeFilter(dept)}}">
        <div># <span>{{index}}</span></div>
        <div>Event name: <span>{{item.name}}</span></div>
        <div>Date: <span>{{item.date}}</span></div>
    </template>


   
  </template>

  <script>;

    Polymer({
      is: 'xl-schedule',
      ready: function() {

              var _thisPage = this;

              fetch('resources/schedule.json').
              then(function (response) {
                  return response.json();
              }).
              then(function (response) {
                _thisPage.schedule = response;
              })
              .catch(function(err) {
                console.log("err",err);
              });

     },
     properties: {
              'dept':{
                        type: String,
                     }
     },
     computeFilter: function(string){
              _self = this;
                var onlineState = (function()
                                                {

                                                  if(_self.$.onlineBox.checked)
                                                    return("online");
                                                  else
                                                    return("Negative");
                                                })();
                                      
                var offlineState = (function()
                                                {
                                                  if(_self.$.offlineBox.checked)
                                                    return("offline");
                                                  else
                                                    return("Negative");
                                                })();
              if(!string || string=='all'){
                return function(schedule){
                  return((schedule.type==onlineState || schedule.type==offlineState));
                }
              }
              else{
                return function(schedule){
                  return(schedule.department==string && (schedule.type==onlineState || schedule.type==offlineState));
                }
              }
     },
     tweakFilter: function(){
        temp=this.dept;
        this.dept="haha";
        this.dept=temp;
     }

    });
  </script>

</dom-module>