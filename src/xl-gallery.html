<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="xl-gallery">
	<template>
  <style>
    img {
      margin: 0;
      padding: 0;
      max-width: calc(100%/3);
      transition: all 0.3s cubic-bezier(.25,.8,.25,1);
    }

    .img-cntr {
      box-shadow: inset 0 0 10px #000000;
    }


    img:hover {
      z-index: 1;
      box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
    }

    .container {
      width: 100%;
      max-width: 980px;
      margin: auto;
      margin-top: 32px;
      background-color: white;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
    }
  </style>

  <div class="container">
      <img src="../images/gallery/0.jpg">      
      <img src="../images/gallery/1.jpg">      
      <img src="../images/gallery/2.jpg">      
      <img src="../images/gallery/3.jpg">      
      <img src="../images/gallery/4.jpg">      
      <img src="../images/gallery/5.jpg">      
      <img src="../images/gallery/6.jpg">      
      <img src="../images/gallery/7.jpg">      
      <img src="../images/gallery/8.jpg">      
      <img src="../images/gallery/9.jpg">      
      <img src="../images/gallery/10.jpg">      
      <img src="../images/gallery/11.jpg">      
  </div>




  </template>

<script>

  Polymer({
    is: 'xl-gallery',
    ready: function() {

      var self = this;
      self.noOfImagesInRow = 2;
      self.counter = 0;
      self.listOfImages = Array.from(self.shadowRoot.querySelectorAll('img'));
      self.target = self.listOfImages.length;

      self.listOfImages.forEach(function (elem) {

        var wait = setInterval(function () {
          if(elem.naturalWidth > 0) {
            self.onHasSize(wait,self);
          }
        }, 100);

      });
    },

    onHasSize : function (loop,self) {
      clearInterval(loop);
      self.counter += 1;

      if (self.counter === self.target) {
      self.displayImages(self);
      var st = document.createElement('style');
      st.innerHTML = "img{max-width : none;}";
      self.shadowRoot.appendChild(st);
      }


    },

    displayImages : function (self) {
      var noOfImagesInRow = self.noOfImagesInRow;

      // console.log('self',self);
      var containerWidth = self.shadowRoot.querySelector('.container').getBoundingClientRect().width;


      var commonHeight = 0,
          nw1 = 0,
          nw2 = 0;



      for(var i = 0; i < self.target; i=i+self.noOfImagesInRow) {

        var naturalDimensions = []




        for(var j = 0; j < self.noOfImagesInRow; j++) {
          console.log('self.listOfImages[i+j]',i,j,self.listOfImages[i+j]);
          naturalDimensions.push({
            w : self.listOfImages[i+j].naturalWidth,
            h : self.listOfImages[i+j].naturalHeight
          });          
        }

        var denominator = 0;

        for(var j = 0; j < naturalDimensions.length; j++) {
          denominator += naturalDimensions[j].w/naturalDimensions[j].h;
        }

        commonHeight = containerWidth / denominator;

        var widthNew = []

        for(var j = 0; j < naturalDimensions.length; j++) {
          widthNew[j] = (naturalDimensions[j].w/naturalDimensions[j].h)*commonHeight;
        }


        for(var j = 0; j < noOfImagesInRow; j++) {
          self.listOfImages[i+j].style.width = widthNew[j]+"px";
          self.listOfImages[i+j].style.height = commonHeight+"px";
        }
      }

    },





  });
</script>
</dom-module>
