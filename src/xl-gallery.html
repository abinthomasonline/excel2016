<html><head><meta charset="UTF-8"><link rel="import" href="xl-app.html"></head><body><dom-module id="xl-gallery">
	<template>
  <style>h1{text-align:center;font-weight:400;font-size:34px;}@media ( min-width: 980px){h1{font-size:56px;}}img{margin:0;padding:0;transition:all 0.25s cubic-bezier(.25,.8,.25,1);}.thumb{width:calc(100%/3);}@media ( max-width: 600px){.thumb{width:calc(100%/2);}}.thumb:hover{z-index:2;box-shadow:0 0 15px 4px rgba(0,0,0,0.5);transform-origin:50% 50%;transform:scale(1.04);cursor:pointer;}.container{width:100%;max-width:980px;margin:auto;margin-top:32px;margin-bottom:32px;background-color:white;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;}#overlay{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:30;transition:all 0.25s cubic-bezier(.25,.8,.25,1);display:flex;justify-content:center;align-items:center;will-change:transform;}#largeImg{transform-origin:0 0;box-sizing:border-box;padding:32px;will-change:transform;}@media ( max-width: 600px){#largeImg{padding:0;}}#bkgColor{position:absolute;top:0;left:0;width:100%;height:100%;transition:all 0.25s cubic-bezier(.25,.8,.25,1);background-color:rgba(0,0,0,0.9);opacity:0;}paper-icon-button{display:none;--paper-icon-button-ink-color :white;}#largeImg{transition:all 0.25s cubic-bezier(.25,.8,.25,1);}</style>
  <h1>Gallery</h1>
  <div class="container"> 
      <template id="galleryRow" is="dom-repeat" items="{{image}}" as="image">
              <img class="thumb" src="{{image.small-src}}" data-full="{{image.large-src}}" on-tap="handleTap" on-load="loadfullimages">
      </template>
  </div>

  <div id="overlay">
    <div id="bkgColor" on-tap="closeImage"></div>
	<paper-icon-button icon="arrow-back" style="color:white" id="arrowL" on-tap="goLeft"></paper-icon-button>
    <img src="" id="largeImg" on-tap="closeImage">
	<paper-icon-button icon="arrow-forward" style="color:white" id="arrowR" on-tap="goRight"></paper-icon-button>
  </div>



  </template>

<script>Polymer({is:"xl-gallery",ready:function(){var t=this;t.noOfImagesInRow=3,t.counter=0,t.fullImagesloadStatus=!1,t.fullImageIndex=0,window.innerWidth<600&&(t.noOfImagesInRow=2),window.onkeyup=function(e){var n=e.keyCode?e.keyCode:e.which;console.log("key",n),37==n&&t.goLeft(),39==n&&t.goRight()},fetch("resources/gallery.json").then(function(t){return t.json()}).then(function(e){t.image=e}).then(function(){t.listOfImages=Array.from(t.shadowRoot.querySelectorAll(".thumb")),t.target=t.listOfImages.length,t.listOfImages.forEach(function(e){var n=setInterval(function(){e.naturalWidth>0&&t.onHasSize(n,t)},100)})}).then(function(){3===t.noOfImagesInRow&&console.log("entered")})},loadfullimages:function(){loadCriteria=this.listOfImages.every(function(t){return!!t.complete}),loadCriteria&&!this.fullImagesloadStatus&&3===this.noOfImagesInRow&&(console.log("All thumbnails loaded"),this.fullImagesloadStatus=!0,this.loadfullimagesStep2())},loadfullimagesStep2:function(){self=this,this.fullImageIndex<this.listOfImages.length&&fetch(this.listOfImages[this.fullImageIndex].dataFull).then(function(t){return 200===t.status?t.blob():void console.error("Full image load error.No: "+this.fullImageIndex)}).then(function(t){self.listOfImages[self.fullImageIndex].src=URL.createObjectURL(t),self.fullImageIndex++,self.loadfullimagesStep2()})},onHasSize:function(t,e){if(clearInterval(t),e.counter+=1,e.counter===e.target){e.displayImages(e);var n=document.createElement("style");n.innerHTML="img{max-width : none;}",e.shadowRoot.appendChild(n)}},displayImages:function(t){for(var e=t.noOfImagesInRow,n=t.shadowRoot.querySelector(".container").getBoundingClientRect().width,s=0,l=0;l<t.target;l+=t.noOfImagesInRow){for(var a=[],i=0;i<t.noOfImagesInRow;i++)t.listOfImages[l+i]&&a.push({w:0!=t.listOfImages[l+i].naturalWidth?t.listOfImages[l+i].naturalWidth:0,h:0!=t.listOfImages[l+i].naturalHeight?t.listOfImages[l+i].naturalHeight:1});for(var o=0,i=0;i<a.length;i++)o+=a[i].w/a[i].h;s=n/o;for(var r=[],i=0;i<a.length;i++)r[i]=a[i].w/a[i].h*s;for(var i=0;i<e;i++)t.listOfImages[l+i]&&(t.listOfImages[l+i].style.width=r[i]+"px",t.listOfImages[l+i].style.height=s+"px")}},handleTap:function(t){var e=t.target;this.lastSelected=e;var n=e.dataFull,s=e.src,l=this.$.arrowL,a=this.$.arrowR;this.fetchLargeImage(n,s);var i=this.$.largeImg;i.style.transition="none",i.style.transform="none";var o=this.$.overlay,r=o.getBoundingClientRect(),g=e.getBoundingClientRect();o.getBoundingClientRect();i.src=e.src;var h=r.width,f=g.width/g.height*r.height,c="90%";window.innerWidth<600&&(c="100%"),h>f?i.style.height=c:i.style.width=c;var u=i.getBoundingClientRect(),d=g.left-u.left+"px",m=g.top-u.top+"px",I="translate("+d+","+m+")",y=g.width/u.width,w=g.height/u.height,v="scale("+y+","+w+")",p=I+" "+v;this.transform=p,i.style.transform=p,i.getBoundingClientRect(),i.style.transition="all 0.25s cubic-bezier(.25,.8,.25,1)",i.style.transform="none",this.$.bkgColor.style.opacity="1",o.style.pointerEvents="auto",window.innerWidth>600&&(l.style.display="block",a.style.display="block")},closeImage:function(){var t=this.$.arrowL,e=this.$.arrowR,n=this.$.overlay,s=this.$.largeImg;n.style.pointerEvents="none",s.style.transform=this.transform,this.$.bkgColor.style.opacity="0",t.style.display="none",e.style.display="none",setTimeout(function(){s.src=""},250)},fetchLargeImage:function(t,e){var n=this.$.largeImg;fetch(t).then(function(t){return t.blob()}).then(function(t){n.src===e&&(n.src=URL.createObjectURL(t))})},goLeft:function(){var t=this.$.largeImg,e=this.lastSelected,n=e.previousElementSibling;this.lastSelected=n,t.src=n.src;var s=n.dataFull,l=n.src;this.fetchLargeImage(s,l);var a=t.getBoundingClientRect(),i=this.lastSelected.getBoundingClientRect();this.setTransform(i,a)},goRight:function(){var t=this.$.largeImg,e=this.lastSelected,n=e.nextElementSibling;this.lastSelected=n,t.src=n.src;var s=n.dataFull,l=n.src;this.fetchLargeImage(s,l);var a=t.getBoundingClientRect(),i=this.lastSelected.getBoundingClientRect();this.setTransform(i,a)},setTransform:function(t,e){var n=t.left-e.left+"px",s=t.top-e.top+"px",l="translate("+n+","+s+")",a=t.width/e.width,i=t.height/e.height,o="scale("+a+","+i+")",r=l+" "+o;this.transform=r}});</script>
</dom-module>
</body></html>