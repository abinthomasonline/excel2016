<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="xl-event-desc.html">

<dom-module id="xl-updates">
  <template>

    <style>
      :host {
        display: block
      }

      h1 {
        text-align: center;
        font-weight: 400;
        font-size: 34px;
      }

      h2 {
      	font-weight: 300;
      }

      @media( min-width: 980px) {
      	h1 {
      		font-size: 56px;
      	}
      }


      .container {
      	position: relative;
      	margin: auto;
      	width: 100%;
      	max-width: 980px;
      	background-color: white;
        padding-top: 32px;
      }



      .card {
      	width: 300px;
      	box-sizing: border-box;
		background: #eee;
		border: 1px solid rgba(0,0,0,0.14);
		box-shadow: 0 0 3px 2px rgba(0,0,0,0.14);
		border-radius: 3px;
		margin: auto;
		margin-bottom: 32px;
		will-change: transform;
      }

      .icon {
      	width: 300px;
      	height: 195px;
      }

      .card h2, .card p {
      	text-align: center;
      	padding-left: 8px;      	
      	padding-right: 8px;      	
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      a:hover {
      	cursor: pointer;
      }

      a:hover .card {
      	box-shadow: 0 0 5px 4px rgba(0,0,0,0.2);
      }

      paper-button {
        background-color: #4285f4;
        color: white;
      }

      .btn-cntr {
        margin-top: 8px;
        margin-bottom: 8px;
        text-align: center;
      }

    </style>


      <h1>Updates</h1>

      <div class="container">


		<a href="">
			<div class="card">
				<img class="icon" src="../images/icons/ShortFilm.png">
				<h2>Excel Theme Song Video</h2>
			</div>      	
		</a>

		<a href="">
	      	<div class="card">
	      		<img class="icon" src="../images/icons/papyrus.jpg">
	      		<h2>Papyrus of Ani</h2>
	      		<p>Papyrus of Ani has started accepting abstracts.</p>
	      	</div>
		</a>


      	<div class="card">
      		<img class="icon" src="../images/icons/3eye.jpg">
      		<h2>Third Eye Photography</h2>
      		<p>First round has started.</p>
      	</div>

      	<div class="card">
      		<img class="icon" src="../images/icons/Soccer.png">
      		<h2>RoboSoccer</h2>
      		<p>Register to participate</p>
      	</div>

      	<div class="card">
      		<img class="icon" src="../images/icons/RoboWars.png">
      		<h2>RoboWar</h2>
      		<p>Register to participate</p>
      	</div>

      	<div class="card">
      		<img class="icon" src="../images/icons/android.png">
      		<h2>Excel Android app</h2>
      	</div>


      	<div class="card">
      		<img class="icon" src="../images/icons/ultimate.png">
      		<h2>Ultimate Engineer</h2>
      		<p>Online prelims has started</p>
      	</div>

      </div>

  </template>

  <script>

    Polymer({
    	is: 'xl-updates',
      ready : function () {

      	var self = this;
		self.cards = Array.from(self.shadowRoot.querySelectorAll('.card'));
		self.containerDimensions = self.shadowRoot.querySelector('.container').getBoundingClientRect();
		self.cardDimensions = [];
		self.marginValue = 16;
		self.ch1 = self.marginValue;
		self.ch2 = self.marginValue;
		self.ch3 = self.marginValue;



		var timer = setInterval(function () {
			self.getCardDimensions();
			self.containerDimensions = self.shadowRoot.querySelector('.container').getBoundingClientRect();
			
			if (self.cards[0].height != 0 && self.containerDimensions.height != 0) {
				clearInterval(timer);
				self.relativeToAbsolute();
				self.cards[0].offsetHeight;
				self.animateToFinalPosition();
			}

		}, 100);

      },

      getCardDimensions : function () {

      	var self = this;

		self.cards.forEach(function (elem) {
			self.cardDimensions.push(elem.getBoundingClientRect());
		});
      	
      },

      relativeToAbsolute : function () {

      	var self = this;

      	console.log('this', this);

		self.cards.forEach(function (elem, index) {

			if (index == 0) {
				console.log('self.cardDimensions[index].left',self.cardDimensions[index].left);
				console.log('self.containerDimensions.left', self.containerDimensions.left);
			}

			elem.style.left = (self.cardDimensions[index].left - self.containerDimensions.left)+"px";
			elem.style.top = (self.cardDimensions[index].top - self.containerDimensions.top)+"px";
			elem.style.position = "absolute";
		});

      },

      animateToFinalPosition : function () {

      	var self = this;

      	console.log('this', this);


		self.cards.forEach(function (elem, index) {

			elem.style.transition = "all 0.75s ease-in-out";//, box-shadow 0.15s ease-in-out
			var topValue = '', leftValue = '';



			if (self.ch1 <= self.ch2 && self.ch1 <= self.ch3) {
				elem.style.left = "20px";
				elem.style.top = self.ch1+"px";
				self.ch1+= self.cardDimensions[index].height + self.marginValue;
			}

			else if( self.ch2 <= self.ch1 && self.ch2 <= self.ch3) {
				elem.style.left = "340px";
				elem.style.top = self.ch2+"px";
				self.ch2+= self.cardDimensions[index].height + self.marginValue;

			}

			else {
				elem.style.left = "660px";
				elem.style.top = self.ch3+"px";
				self.ch3+=self.cardDimensions[index].height + self.marginValue;
			}

		});
      }

    });
  </script>

</dom-module>