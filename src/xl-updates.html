<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="xl-event-desc.html">

<dom-module id="xl-updates">
  <template>

    <style>
      :host {
        display: block
      }

    h1 {
        text-align: center;
        font-weight: 400;
        font-size: 34px;
        color: rgba(0,0,0,0.65);
    }

    @media( min-width: 980px) {
        h1 {
          font-size: 56px;
        }
    }

    h2 {
    	font-weight: 300;
    }



      .container {
      	position: relative;
      	margin: auto;
      	width: 100%;
      	max-width: 980px;
      	background-color: white;
        padding-top: 32px;
      }



      .card {
        position: absolute;
      	width: 300px;
      	box-sizing: border-box;
    		background: #eee;
    		border: 1px solid rgba(0,0,0,0.14);
    		box-shadow: 0 0 3px 2px rgba(0,0,0,0.14);
    		border-radius: 3px;
    		margin: auto;
    		margin-bottom: 32px;
    		will-change: transform;
        opacity: 0;
      }

      .icon {
      	width: 300px;
      	height: 195px;
      }

      .card h2, .card p {
      	text-align: center;
      	padding-left: 8px;      	
      	padding-right: 8px;      	
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      a:hover {
      	cursor: pointer;
      }

      a:hover .card {
      	box-shadow: 0 0 5px 4px rgba(0,0,0,0.12);
      }

      paper-button {
        background-color: #4285f4;
        color: white;
      }

      .btn-cntr {
        margin-top: 8px;
        margin-bottom: 8px;
        text-align: center;
      }

      @keyframes slide-in {
        from {
          transform: translateY(100%);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @media( max-width: 980px) {
        .container {
          width: 660px;
        }
      }


      @media( max-width: 600px) {
        .container {
          width: 340px;
        }
      }

      @media( max-width: 339px) {
        .card,.icon {
          width: 280px;
        }
      }

    </style>


      <h1>Updates</h1>

      <div class="container">

        <a href="#/schedule/">
          <div class="card">
            <img class="icon" src="../images/calendar.png">
            <h2>Schedule is up</h2>
          </div>      
        </a>



        <a href="#/competitions/nontech-events/third-eye">
          <div class="card">
            <img class="icon" src="../images/icons/3eye.jpg">
            <h2>Third Eye Photography</h2>
            <p>Third round has started.</p>
          </div>      
        </a>

        <a href="#/competitions/cs-events/binbash">
          <div class="card">
            <img class="icon" src="../images/icons/binbash.png">
            <h2>Binbash</h2>
            <p>Event launched.</p>
          </div>
        </a>


        <a href="#/competitions/cs-events/hackmaster">
          <div class="card">
            <img class="icon" src="../images/icons/hackmaster.png"">
            <h2>Hackmaster</h2>
            <p>Event launched.</p>
          </div>
        </a>

        <a href="#/gamezone">
          <div class="card">
            <img class="icon" src="../images/icons/GameZone.png">
            <h2>Check out Game Zone</h2>
          </div>
        </a>

        <a href="#/competitions/cs-events/commerceninja">
          <div class="card">
            <img class="icon" src="../images/icons/commerceText.png">
            <h2>Commerce Ninja</h2>
            <p>Event registration has begun.</p>
          </div>
        </a>
        
        <a href="#/competitions/nontech-events/dalal-bull">
          <div class="card">
            <img class="icon" src="../images/icons/dalalbull.jpg"">
            <h2>DalalBull</h2>
            <p>Event launched.</p>
          </div>
        </a>

        <a href="#/competitions/nontech-events/kryptos">
          <div class="card">
            <img class="icon" src="../images/icons/kryptos.png">
            <h2>Kryptos</h2>
            <p>Event Kryptos has been launched.Start playing now!.</p>
          </div>
        </a>

        <a href="#/competitions/general-events/papyrus-of-ani">
          <div class="card">
            <img class="icon" src="../images/icons/papyrus.jpg">
            <h2>Papyrus of Ani</h2>
            <p>Event registration closed.</p>
          </div>
        </a>

        <a href="#/competitions/ec-events/techathon">
          <div class="card">
            <img class="icon" src="../images/icons/techathon.png">
            <h2>Techathon</h2>
            <p>Event registration open.</p>
          </div>
        </a>

        <a href="#/competitions/ec-events/circuimstance-online">
          <div class="card">
            <img class="icon" src="../images/icons/circum.png">
            <h2>Circuimstance</h2>
            <p>Start playing now.</p>
          </div>      
        </a>


        <a href="#/competitions/eee-events/ultimate-engineer">
          <div class="card">
            <img class="icon" src="../images/icons/ultimate.png">
            <h2>Ultimate Engineer</h2>
            <p>Prelims over.</p>
          </div>      
        </a>

        <a target="_blank" href="https://www.youtube.com/watch?v=KhQ_cTJcjgo">
          <div class="card">
            <img class="icon" src="../images/icons/ShortFilm.png">
            <h2>Excel Theme Song Video</h2>
          </div>        
        </a>

        <a href="#/competitions/robo-events/robo-soccer">
          <div class="card">
            <img class="icon" src="../images/icons/Soccer.png">
            <h2>RoboSoccer</h2>
            <p>Register to participate</p>
          </div>      
        </a>

        <a href="#/competitions/robo-events/robo-war">
          <div class="card">
            <img class="icon" src="../images/icons/RoboWars.png">
            <h2>RoboWar</h2>
            <p>Register to participate</p>
          </div>
        </a>

        <a target="_blank" href="https://play.google.com/store/apps/details?id=mec.mec.excel16">
          <div class="card">
            <img class="icon" src="../images/icons/android.png">
            <h2>Excel Android app</h2>
          </div>      
        </a>


      </div>

  </template>

  <script>

    Polymer({
    	is: 'xl-updates',
      ready : function () {

        var self = this;
    		self.cards = Array.from(self.shadowRoot.querySelectorAll('.card'));
    		self.containerDimensions = self.shadowRoot.querySelector('.container').getBoundingClientRect();
    		self.cardDimensions = [];
    		self.marginValue = 16;
        self.delay = 0.1;


        window.addEventListener('resize', function () {
          // self.getCardDimensions();
          self.animateToFinalPosition(self);
        });


        // column height
    		self.colHeight = [self.marginValue,self.marginValue,self.marginValue];

    		var timer = setInterval(function () {
    			self.getCardDimensions();
    			self.containerDimensions = self.shadowRoot.querySelector('.container').getBoundingClientRect();
    			
    			if (self.cards[0].height != 0 && self.containerDimensions.height != 0) {
    				clearInterval(timer);
            // alert("called");
            self.animateToFinalPosition();
    			}

    		}, 100);

      },

      getCardDimensions : function () {

      	var self = this;
    		self.cards.forEach(function (elem) {
    			self.cardDimensions.push(elem.getBoundingClientRect());
    		});
      	
      },

      animateToFinalPosition : function (self) {

      	var self = this || self;

        // column height
        self.colHeight = [self.marginValue,self.marginValue,self.marginValue];
        self.delay = 0.1;


      	console.log('self', self);

        var numberOfColumns = 3;
        var viewportWidth = window.innerWidth;

        console.log('viewportWidth',viewportWidth);

        if (viewportWidth < 980) {
          numberOfColumns = 2;
        }


        if (viewportWidth < 600) {
          numberOfColumns = 1;
        }

        console.log('self.cards',self.cards);


    		self.cards.forEach(function (elem, index) {
          elem.style.transition = "all 0.35s ease-in-out, box-shadow 0.15s ease-in-out";
          elem.style.animation = "slide-in 0.5s ease-in-out  forwards "+self.delay+"s";
          self.delay += 0.1;
          var colWithMinHeight = 0;

          self.colHeight.slice(0,numberOfColumns).forEach(function (elem, index) {
            if (elem <= self.colHeight[colWithMinHeight]) {
              colWithMinHeight = index;
            }
          });

          switch (colWithMinHeight) {
            case 0:
              elem.style.left = "20px";
              break;
            case 1:
              elem.style.left = "340px";
              break;
            case 2:
              elem.style.left = "660px";
              break;
          }

          elem.style.top = self.colHeight[colWithMinHeight]+"px";
          self.colHeight[colWithMinHeight] += self.cardDimensions[index].height + self.marginValue;


    		});
      }
    });
  </script>

</dom-module>